{"version":3,"sources":["Chessboard.js"],"names":["Constants","require","CHESS_TYPE","STAND","GAME_STATE","cc","Class","extends","Component","properties","COL","ROW","chessPrefab","Prefab","chesses","onLoad","G","chessManager","chessWidth","node","width","x","y","chessNode","instantiate","parent","height","position","v2","chess","getComponent","coor","addTouchEvent","type","BLACK","WHITE","gameManager","startGame","self","on","Node","EventType","TOUCH_END","e","gameState","PLAYING","turn","stand","NONE","judgePass","fallChess","changeTurn","tempChess","dir","nearChess"],"mappings":"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","file":"Chessboard.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\manager","sourcesContent":["const Constants = require('Constants');\r\nconst CHESS_TYPE = Constants.CHESS_TYPE;\r\nconst STAND = Constants.STAND;\r\nconst GAME_STATE = Constants.GAME_STATE;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        COL: 0,\r\n        ROW: 0,\r\n        chessPrefab: cc.Prefab,\r\n        chesses: []\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        G.chessManager = this;\r\n        let chessWidth = this.node.width / this.COL;\r\n        for (let x = 0; x < this.COL; x++) {\r\n            this.chesses[x] = [];\r\n            for (let y = 0; y < this.ROW; y++) {\r\n                let chessNode = cc.instantiate( this.chessPrefab );\r\n                chessNode.parent = this.node;\r\n                chessNode.width = chessWidth - 15;\r\n                chessNode.height = chessWidth - 15;\r\n                chessNode.position = cc.v2( chessWidth/2 + x*chessWidth, chessWidth/2 + y*chessWidth );\r\n                \r\n                let chess = chessNode.getComponent('Chess');\r\n                chess.coor = cc.v2(x, y);\r\n                \r\n                this.chesses[x][y] = chess;\r\n\r\n                // 添加点击事件\r\n                this.addTouchEvent(chess);\r\n            }\r\n        }\r\n\r\n        // 默认四颗棋子\r\n        this.chesses[3][3].type = CHESS_TYPE.BLACK;\r\n        this.chesses[3][4].type = CHESS_TYPE.WHITE;\r\n        this.chesses[4][3].type = CHESS_TYPE.WHITE;\r\n        this.chesses[4][4].type = CHESS_TYPE.BLACK;\r\n\r\n        // 开始游戏\r\n        G.gameManager.startGame();\r\n\r\n    },\r\n\r\n    // 下棋点击事件\r\n    addTouchEvent(chess) {\r\n        let self = this;\r\n        chess.node.on( cc.Node.EventType.TOUCH_END, function(e) {\r\n            if ( G.gameManager.gameState === GAME_STATE.PLAYING && G.gameManager.turn === G.stand ) {\r\n                if( chess.type === CHESS_TYPE.NONE ) {\r\n                    if( self.judgePass(G.stand, chess) ) {\r\n                        self.fallChess(chess);\r\n                        G.gameManager.changeTurn();\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    },\r\n\r\n    // 判断该点能否下\r\n    judgePass(turn, chess) {\r\n        let tempChess = chess;\r\n        for (let dir = 1; dir <= 8; dir++) {\r\n            let tempChess = this.nearChess(chess, dir);\r\n            while( tempChess !== null && tempChess.type === -turn ) {\r\n                tempChess = this.nearChess(tempChess, dir);\r\n                if( tempChess.type === turn ){\r\n                    return true;\r\n                }\r\n            } \r\n        }\r\n        return false;\r\n    },\r\n\r\n    // 获该点8个方向，某个方向的棋子\r\n    nearChess(chess, dir) {\r\n        switch (dir) {\r\n            case 1://left\r\n                if (chess.coor.x !== 0) {\r\n                    return this.chesses[chess.coor.x - 1][chess.coor.y];\r\n                }\r\n                break;\r\n            case 2://left up\r\n                if (chess.coor.x !== 0 && chess.coor.y !== this.ROW - 1) {\r\n                    return this.chesses[chess.coor.x - 1][chess.coor.y + 1];\r\n                }\r\n                break;\r\n            case 3://up\r\n                if (chess.coor.y !== this.ROW - 1) {\r\n                    return this.chesses[chess.coor.x][chess.coor.y + 1];\r\n                }\r\n                break;\r\n            case 4://right up\r\n                if (chess.coor.x !== this.COL - 1 && chess.coor.y !== this.ROW - 1) {\r\n                    return this.chesses[chess.coor.x + 1][chess.coor.y + 1];\r\n                }\r\n                break;\r\n            case 5://right\r\n                if (chess.coor.x !== this.COL - 1) {\r\n                    return this.chesses[chess.coor.x + 1][chess.coor.y];\r\n                }\r\n                break;\r\n            case 6://right down\r\n                if (chess.coor.x !== this.COL - 1 && chess.coor.y !== 0) {\r\n                    return this.chesses[chess.coor.x + 1][chess.coor.y - 1];\r\n                }\r\n                break;\r\n            case 7://down\r\n                if (chess.coor.y !== 0) {\r\n                    return this.chesses[chess.coor.x][chess.coor.y - 1];\r\n                }\r\n                break;\r\n            case 8://left down\r\n                if (chess.coor.x !== 0 && chess.coor.y !== 0) {\r\n                    return this.chesses[chess.coor.x - 1][chess.coor.y - 1];\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        return null;\r\n    },\r\n\r\n    // 下棋子\r\n    fallChess(chess) {\r\n        chess.type = G.gameManager.turn;\r\n    }\r\n\r\n    // start () {\r\n\r\n    // },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}