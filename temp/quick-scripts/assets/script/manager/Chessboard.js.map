{"version":3,"sources":["Chessboard.js"],"names":["Constants","require","CHESS_TYPE","STAND","GAME_STATE","cc","Class","extends","Component","properties","COL","ROW","chessPrefab","Prefab","chesses","onLoad","G","chessManager","chessWidth","node","width","x","y","chessNode","instantiate","parent","height","position","v2","chess","getComponent","coor","addTouchEvent","type","BLACK","WHITE","gameManager","startGame","self","roomSocket","on","chessCoor","fallChess","turn","changeTurn","Node","EventType","TOUCH_END","e","gameState","PLAYING","stand","NONE","judgePass","emit","dir","judgeOneDir","tempChess","nearChess","console","log","judgeMoveAble","tryChess","judgeWin","selfMoveAble","oppoMoveAble","changeChess"],"mappings":"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","file":"Chessboard.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\manager","sourcesContent":["const Constants = require('Constants');\r\nconst CHESS_TYPE = Constants.CHESS_TYPE;\r\nconst STAND = Constants.STAND;\r\nconst GAME_STATE = Constants.GAME_STATE;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        COL: 0,\r\n        ROW: 0,\r\n        chessPrefab: cc.Prefab,\r\n        chesses: []\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        G.chessManager = this;\r\n        let chessWidth = this.node.width / this.COL;\r\n        for (let x = 0; x < this.COL; x++) {\r\n            this.chesses[x] = [];\r\n            for (let y = 0; y < this.ROW; y++) {\r\n                let chessNode = cc.instantiate( this.chessPrefab );\r\n                chessNode.parent = this.node;\r\n                chessNode.width = chessWidth - 15;\r\n                chessNode.height = chessWidth - 15;\r\n                chessNode.position = cc.v2( chessWidth/2 + x*chessWidth, chessWidth/2 + y*chessWidth );\r\n                \r\n                let chess = chessNode.getComponent('Chess');\r\n                chess.coor = cc.v2(x, y);\r\n                \r\n                this.chesses[x][y] = chess;\r\n\r\n                // 添加点击事件\r\n                this.addTouchEvent(chess);\r\n            }\r\n        }\r\n\r\n        // 默认四颗棋子\r\n        this.chesses[3][3].type = CHESS_TYPE.BLACK;\r\n        this.chesses[3][4].type = CHESS_TYPE.WHITE;\r\n        this.chesses[4][3].type = CHESS_TYPE.WHITE;\r\n        this.chesses[4][4].type = CHESS_TYPE.BLACK;\r\n\r\n        // 开始游戏\r\n        G.gameManager.startGame();\r\n\r\n        let self = this;\r\n        // 监听 更新棋盘\r\n        G.roomSocket.on('update chessboard', function(chessCoor){\r\n            self.fallChess(G.gameManager.turn, self.chesses[chessCoor.x][chessCoor.y]);\r\n        });\r\n        // 监听 换边\r\n        G.roomSocket.on('change turn', function () {\r\n            G.gameManager.changeTurn();\r\n        });\r\n\r\n    },\r\n\r\n    // 下棋点击事件\r\n    addTouchEvent(chess) {\r\n        let self = this;\r\n        chess.node.on( cc.Node.EventType.TOUCH_END, function(e) {\r\n            if ( G.gameManager.gameState === GAME_STATE.PLAYING && G.gameManager.turn === G.stand ) {\r\n                if( chess.type === CHESS_TYPE.NONE ) {\r\n                    if( self.judgePass(G.gameManager.turn, chess) ) {\r\n                        self.fallChess(G.gameManager.turn, chess);\r\n                        // 换边\r\n                        G.gameManager.changeTurn();\r\n                        // 更新对应点棋子\r\n                        G.roomSocket.emit('update chessboard', chess.coor);\r\n                        // 通知换边\r\n                        G.roomSocket.emit('change turn');\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    },\r\n\r\n    // 判断该点能否下\r\n    judgePass(turn, chess) {\r\n        for (let dir = 1; dir <= 8; dir++) {\r\n            if( this.judgeOneDir(chess, turn, dir) ){\r\n                return true;\r\n            }\r\n            // return this.judgeOneDir(chess, turn, dir)\r\n        }\r\n        return false;\r\n    },\r\n\r\n    // 判断一个方向能否下棋\r\n    judgeOneDir(chess, turn, dir) {\r\n        let tempChess = this.nearChess(chess, dir);\r\n        while( tempChess !== null && tempChess.type === -turn ) {\r\n            tempChess = this.nearChess(tempChess, dir);\r\n            console.log(tempChess)\r\n            console.log(dir)\r\n            console.log(turn)\r\n            if( tempChess.type === turn ){\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    // 判断玩家是否还有棋子可下\r\n    judgeMoveAble(turn) {\r\n        let tryChess = null;\r\n        for (let x = 0; x < this.COL; x++) {\r\n            for (let y = 0; y < this.ROW; y++) {\r\n                tryChess = this.chesses[x][y];\r\n                if (tryChess.type === CHESS_TYPE.NONE) {\r\n                    this.judgePass(turn, tryChess);\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    // 判断输赢\r\n    judgeWin( turn ) {\r\n        let selfMoveAble = this.judgeMoveAble( turn );\r\n        let oppoMoveAble = this.judgeMoveAble( -turn );\r\n        if ( !selfMoveAble && oppoMoveAble ) {\r\n            G.gameManager.changeTurn();\r\n        }\r\n    },\r\n    \r\n    // 下棋子\r\n    fallChess(turn, chess) {\r\n        chess.type = turn;\r\n        // 棋子变色\r\n        this.changeChess(G.gameManager.turn, chess);\r\n    },\r\n\r\n    // 棋子变色\r\n    changeChess(turn, chess) {\r\n        for (let dir = 1; dir <= 8; dir++) {\r\n            let tempChess = chess;\r\n            if ( this.judgeOneDir(chess, turn, dir) ) {\r\n                tempChess = this.nearChess(tempChess, dir);\r\n                while ( tempChess.type !== turn ) {\r\n                    tempChess.type = turn;\r\n                    tempChess = this.nearChess(tempChess, dir);\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    // 获该点8个方向，某个方向的棋子\r\n    nearChess(chess, dir) {\r\n        switch (dir) {\r\n            case 1://left\r\n                if (chess.coor.x !== 0) {\r\n                    return this.chesses[chess.coor.x - 1][chess.coor.y];\r\n                }\r\n                break;\r\n            case 2://left up\r\n                if (chess.coor.x !== 0 && chess.coor.y !== this.ROW - 1) {\r\n                    return this.chesses[chess.coor.x - 1][chess.coor.y + 1];\r\n                }\r\n                break;\r\n            case 3://up\r\n                if (chess.coor.y !== this.ROW - 1) {\r\n                    return this.chesses[chess.coor.x][chess.coor.y + 1];\r\n                }\r\n                break;\r\n            case 4://right up\r\n                if (chess.coor.x !== this.COL - 1 && chess.coor.y !== this.ROW - 1) {\r\n                    return this.chesses[chess.coor.x + 1][chess.coor.y + 1];\r\n                }\r\n                break;\r\n            case 5://right\r\n                if (chess.coor.x !== this.COL - 1) {\r\n                    return this.chesses[chess.coor.x + 1][chess.coor.y];\r\n                }\r\n                break;\r\n            case 6://right down\r\n                if (chess.coor.x !== this.COL - 1 && chess.coor.y !== 0) {\r\n                    return this.chesses[chess.coor.x + 1][chess.coor.y - 1];\r\n                }\r\n                break;\r\n            case 7://down\r\n                if (chess.coor.y !== 0) {\r\n                    return this.chesses[chess.coor.x][chess.coor.y - 1];\r\n                }\r\n                break;\r\n            case 8://left down\r\n                if (chess.coor.x !== 0 && chess.coor.y !== 0) {\r\n                    return this.chesses[chess.coor.x - 1][chess.coor.y - 1];\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        return null;\r\n    },\r\n    \r\n\r\n    // start () {\r\n\r\n    // },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}